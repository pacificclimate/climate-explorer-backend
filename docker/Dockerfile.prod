# Image with gdal 3.3.0
FROM pcic/geospatial-python:3.3.0

RUN apk add postgresql-dev libxml2-dev libxslt-dev geos-dev

COPY . /app
WORKDIR /app

RUN apk add libffi-dev
RUN wget -O - https://install.python-poetry.org | python3 -
ENV PATH=/root/.local/bin:$PATH
RUN poetry install

EXPOSE 8000

COPY --chmod=755 docker/secrets.sh /app/secrets.sh
COPY --chmod=755 docker/entrypoint-prod.sh /app/entrypoint.sh

ENTRYPOINT ["/app/secrets.sh", "/app/entrypoint.sh"]